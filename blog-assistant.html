<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¹ì¸í–‰ì •ì‚¬ ë¸”ë¡œê·¸ ìë™ ì‘ì„± ë„ìš°ë¯¸</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .topic-card { transition: all 0.3s ease; }
        .topic-card:hover { transform: translateY(-4px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        
        .markdown-content h1 { font-size: 2em; font-weight: bold; margin-top: 1em; margin-bottom: 0.5em; }
        .markdown-content h2 { font-size: 1.5em; font-weight: bold; margin-top: 1em; margin-bottom: 0.5em; }
        .markdown-content h3 { font-size: 1.25em; font-weight: bold; margin-top: 0.8em; margin-bottom: 0.4em; }
        .markdown-content p { margin-bottom: 1em; line-height: 1.7; }
        .markdown-content ul, .markdown-content ol { margin-left: 2em; margin-bottom: 1em; }
        .markdown-content li { margin-bottom: 0.5em; }
        .markdown-content strong { font-weight: bold; }
        .markdown-content em { font-style: italic; }
        .markdown-content code { background: #f3f4f6; padding: 2px 6px; border-radius: 3px; font-family: monospace; }
        .markdown-content hr { margin: 2em 0; border: 0; border-top: 2px solid #e5e7eb; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen">
    <div id="app"></div>

    <script>
        const API_BASE = '/api';
        
        // Simple Markdown to HTML converter
        function markdownToHtml(md) {
            let html = md;
            
            // Headers
            html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');
            
            // Bold
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Italic
            html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // Lists
            html = html.replace(/^\d+\.\s+(.*)$/gim, '<li>$1</li>');
            html = html.replace(/^-\s+(.*)$/gim, '<li>$1</li>');
            html = html.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
            
            // Paragraphs
            html = html.split('\n\n').map(para => {
                if (!para.match(/^<[hul]/)) {
                    return '<p>' + para.replace(/\n/g, '<br>') + '</p>';
                }
                return para;
            }).join('\n');
            
            // Horizontal rule
            html = html.replace(/^---$/gim, '<hr>');
            
            return html;
        }

        class BlogAssistant {
            constructor() {
                this.state = {
                    currentStep: 'topics', // topics, content, images, preview
                    topics: [],
                    selectedTopic: null,
                    generatedContent: '',
                    generatedImages: [],
                    loading: false,
                    error: null
                };
                
                this.render();
                this.loadTopics();
            }
            
            async loadTopics() {
                this.setState({ loading: true, error: null });
                try {
                    const response = await fetch(`${API_BASE}/topics`);
                    const data = await response.json();
                    if (data.success) {
                        this.setState({ topics: data.topics, loading: false });
                    } else {
                        throw new Error('ì£¼ì œ ë¡œë“œ ì‹¤íŒ¨');
                    }
                } catch (error) {
                    this.setState({ error: 'ì£¼ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì„œë²„ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.', loading: false });
                }
            }
            
            async generateContent(topic) {
                this.setState({ loading: true, error: null, selectedTopic: topic });
                try {
                    const response = await fetch(`${API_BASE}/generate-content`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ topic })
                    });
                    const data = await response.json();
                    if (data.success) {
                        this.setState({ 
                            generatedContent: data.content, 
                            loading: false,
                            currentStep: 'content'
                        });
                    } else {
                        throw new Error('ì½˜í…ì¸  ìƒì„± ì‹¤íŒ¨');
                    }
                } catch (error) {
                    this.setState({ error: 'ì½˜í…ì¸  ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', loading: false });
                }
            }
            
            async generateImages() {
                this.setState({ loading: true, error: null });
                try {
                    const response = await fetch(`${API_BASE}/generate-image-prompt`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ topic: this.state.selectedTopic })
                    });
                    const data = await response.json();
                    console.log('Image API Response:', data);
                    
                    if (data.success && data.prompt && data.prompt.all) {
                        // 6ê°œì˜ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„±
                        const imagePrompts = data.prompt.all;
                        const images = Object.keys(imagePrompts).map((key, index) => ({
                            id: key,
                            title: this.getImageTitle(key),
                            prompt: imagePrompts[key],
                            placeholder: `https://via.placeholder.com/800x500/4F46E5/FFFFFF?text=ì´ë¯¸ì§€${key}:+${encodeURIComponent(this.getImageTitle(key))}`
                        }));
                        
                        this.setState({ 
                            generatedImages: images,
                            loading: false,
                            currentStep: 'images'
                        });
                    } else {
                        console.error('Invalid response structure:', data);
                        throw new Error('ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„± ì‹¤íŒ¨: ' + (data.error || 'ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜'));
                    }
                } catch (error) {
                    console.error('Image generation error:', error);
                    this.setState({ error: 'ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, loading: false });
                }
            }
            
            getImageTitle(imageId) {
                const titles = {
                    '1': 'ë©”ì¸/ë„ì… - ì „ë¬¸ì ì¸ ì‚¬ë¬´ì‹¤',
                    '2': 'ìƒë‹´ ì¥ë©´ - ë”°ëœ»í•œ ìƒë‹´',
                    '3': 'ì£¼ì œë³„ íŠ¹í™” - ê´€ë ¨ ì—…ë¬´',
                    '4': 'ì—…ë¬´ í”„ë¡œì„¸ìŠ¤ - ì„œë¥˜ ì‘ì—…',
                    '5': 'ì„±ê³µ/ê²°ê³¼ - ì‹ ë¢°ì˜ ì•…ìˆ˜',
                    '6': 'í”„ë¡œí•„ - ì „ë¬¸ê°€ ëª¨ìŠµ'
                };
                return titles[imageId] || `ì´ë¯¸ì§€ ${imageId}`;
            }
            
            copyToClipboard() {
                const textArea = document.createElement('textarea');
                textArea.value = this.state.generatedContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('ë¸”ë¡œê·¸ ê¸€ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
            
            downloadContent() {
                const element = document.createElement('a');
                const file = new Blob([this.state.generatedContent], {type: 'text/plain'});
                element.href = URL.createObjectURL(file);
                element.download = `${this.state.selectedTopic.title}.txt`;
                document.body.appendChild(element);
                element.click();
                document.body.removeChild(element);
            }
            
            reset() {
                this.state = {
                    currentStep: 'topics',
                    topics: this.state.topics,
                    selectedTopic: null,
                    generatedContent: '',
                    generatedImages: [],
                    loading: false,
                    error: null
                };
                this.render();
            }
            
            setState(newState) {
                this.state = { ...this.state, ...newState };
                this.render();
            }
            
            render() {
                const app = document.getElementById('app');
                app.innerHTML = `
                    <div class="min-h-screen p-4 md:p-8">
                        <!-- Header -->
                        <header class="max-w-6xl mx-auto mb-8 animate-fade-in">
                            <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8 border-t-4 border-indigo-600">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">
                                            ğŸ“ ìŠ¹ì¸í–‰ì •ì‚¬ ë¸”ë¡œê·¸ ë„ìš°ë¯¸
                                        </h1>
                                        <p class="text-gray-600">ì£¼ì œ ì¶”ì²œë¶€í„° ì´ë¯¸ì§€ ìƒì„±ê¹Œì§€ ìë™ìœ¼ë¡œ!</p>
                                    </div>
                                    ${this.state.currentStep !== 'topics' ? `
                                        <button onclick="assistant.reset()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors">
                                            ğŸ  ì²˜ìŒìœ¼ë¡œ
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </header>

                        <!-- Main Content -->
                        <main class="max-w-6xl mx-auto">
                            ${this.state.error ? `
                                <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded animate-fade-in">
                                    <p class="text-red-700">${this.state.error}</p>
                                </div>
                            ` : ''}
                            
                            ${this.renderStep()}
                        </main>

                        <!-- Footer -->
                        <footer class="max-w-6xl mx-auto mt-12 text-center text-gray-500 text-sm">
                            <p>Â© 2024 ìŠ¹ì¸í–‰ì •ì‚¬ ê¹€ìˆ˜ë¹ˆ ì‚¬ë¬´ì†Œ | ë„¤ì´ë²„ ë¸”ë¡œê·¸ ìë™í™” ë„êµ¬</p>
                        </footer>
                    </div>
                `;
            }
            
            renderStep() {
                if (this.state.loading) {
                    return `
                        <div class="bg-white rounded-2xl shadow-lg p-12 text-center animate-fade-in">
                            <div class="w-16 h-16 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                            <p class="text-gray-600 text-lg">ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</p>
                        </div>
                    `;
                }
                
                switch (this.state.currentStep) {
                    case 'topics':
                        return this.renderTopics();
                    case 'content':
                        return this.renderContent();
                    case 'images':
                        return this.renderImages();
                    default:
                        return '';
                }
            }
            
            renderTopics() {
                return `
                    <div class="animate-fade-in">
                        <div class="mb-6">
                            <h2 class="text-2xl font-bold text-gray-800 mb-2">ğŸ“š ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì£¼ì œ</h2>
                            <p class="text-gray-600">ë§ˆìŒì— ë“œëŠ” ì£¼ì œë¥¼ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ë¸”ë¡œê·¸ ê¸€ì„ ì‘ì„±í•´ë“œë¦½ë‹ˆë‹¤</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${this.state.topics.map(topic => `
                                <div class="topic-card bg-white rounded-xl shadow-md p-6 cursor-pointer border-2 border-transparent hover:border-indigo-500" 
                                     onclick="assistant.generateContent(${JSON.stringify(topic).replace(/"/g, '&quot;')})">
                                    <div class="flex items-center justify-between mb-3">
                                        <span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-sm font-semibold">
                                            ${topic.category}
                                        </span>
                                        <span class="text-2xl">ğŸ“„</span>
                                    </div>
                                    <h3 class="text-lg font-bold text-gray-800 mb-2">${topic.title}</h3>
                                    <p class="text-gray-600 text-sm">${topic.description}</p>
                                </div>
                            `).join('')}
                        </div>
                        
                        ${this.state.topics.length === 0 ? `
                            <div class="bg-white rounded-xl shadow-md p-12 text-center">
                                <p class="text-gray-500">ì£¼ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            renderContent() {
                return `
                    <div class="animate-fade-in space-y-6">
                        <!-- Progress -->
                        <div class="bg-white rounded-xl shadow-md p-4">
                            <div class="flex items-center justify-between text-sm">
                                <div class="flex items-center space-x-2">
                                    <div class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center font-bold">âœ“</div>
                                    <span class="font-medium text-gray-700">ì£¼ì œ ì„ íƒ</span>
                                </div>
                                <div class="h-1 flex-1 bg-green-500 mx-2"></div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold">2</div>
                                    <span class="font-medium text-indigo-600">ê¸€ ì‘ì„±</span>
                                </div>
                                <div class="h-1 flex-1 bg-gray-200 mx-2"></div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-8 h-8 bg-gray-200 text-gray-500 rounded-full flex items-center justify-center font-bold">3</div>
                                    <span class="font-medium text-gray-500">ì´ë¯¸ì§€ ìƒì„±</span>
                                </div>
                            </div>
                        </div>

                        <!-- Content Display -->
                        <div class="bg-white rounded-xl shadow-lg p-8">
                            <div class="mb-6">
                                <h2 class="text-2xl font-bold text-gray-800 mb-2">âœï¸ ì‘ì„±ëœ ë¸”ë¡œê·¸ ê¸€</h2>
                                <p class="text-gray-600">ë‚´ìš©ì„ í™•ì¸í•˜ê³  ìˆ˜ì •í•˜ì‹  í›„ ë³µì‚¬í•˜ì„¸ìš”</p>
                            </div>
                            
                            <div class="markdown-content prose max-w-none bg-gray-50 rounded-lg p-6 border border-gray-200 mb-6" 
                                 style="max-height: 500px; overflow-y: auto;">
                                ${markdownToHtml(this.state.generatedContent)}
                            </div>
                            
                            <div class="flex flex-wrap gap-3">
                                <button onclick="assistant.copyToClipboard()" 
                                        class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center gap-2">
                                    ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬
                                </button>
                                <button onclick="assistant.downloadContent()" 
                                        class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center gap-2">
                                    ğŸ’¾ í…ìŠ¤íŠ¸ íŒŒì¼ë¡œ ì €ì¥
                                </button>
                                <button onclick="assistant.generateImages()" 
                                        class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center gap-2">
                                    ğŸ¨ ì´ë¯¸ì§€ ìƒì„±í•˜ê¸° â†’
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderImages() {
                return `
                    <div class="animate-fade-in space-y-6">
                        <!-- Progress -->
                        <div class="bg-white rounded-xl shadow-md p-4">
                            <div class="flex items-center justify-between text-sm">
                                <div class="flex items-center space-x-2">
                                    <div class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center font-bold">âœ“</div>
                                    <span class="font-medium text-gray-700">ì£¼ì œ ì„ íƒ</span>
                                </div>
                                <div class="h-1 flex-1 bg-green-500 mx-2"></div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center font-bold">âœ“</div>
                                    <span class="font-medium text-gray-700">ê¸€ ì‘ì„±</span>
                                </div>
                                <div class="h-1 flex-1 bg-green-500 mx-2"></div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold">3</div>
                                    <span class="font-medium text-indigo-600">ì´ë¯¸ì§€ ìƒì„±</span>
                                </div>
                            </div>
                        </div>

                        <!-- Image Display -->
                        <div class="bg-white rounded-xl shadow-lg p-8">
                            <div class="mb-6">
                                <h2 class="text-2xl font-bold text-gray-800 mb-2">ğŸ¨ ë¸”ë¡œê·¸ìš© ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ (ì´ 6ì¥)</h2>
                                <p class="text-gray-600">ê° ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ë¥¼ AI ì´ë¯¸ì§€ ìƒì„± ë„êµ¬(Midjourney, DALL-E ë“±)ì— ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ì„¸ìš”</p>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            ${this.state.generatedImages.map((img, idx) => `
                                <div class="border-2 border-gray-200 rounded-xl p-4 hover:border-indigo-400 transition-colors">
                                    <div class="mb-3">
                                        <img src="${img.placeholder}" alt="${img.title}" class="w-full rounded-lg shadow-sm mb-2">
                                        <h3 class="font-bold text-indigo-900 text-sm">ğŸ“· ì´ë¯¸ì§€ ${img.id}: ${img.title}</h3>
                                    </div>
                                    <div class="bg-gray-50 p-3 rounded-lg border border-gray-200">
                                        <div class="flex justify-between items-center mb-2">
                                            <p class="text-xs text-gray-600 font-semibold">AI ìƒì„± í”„ë¡¬í”„íŠ¸:</p>
                                            <button onclick="navigator.clipboard.writeText('${img.prompt.replace(/'/g, "\\'")}'); alert('í”„ë¡¬í”„íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!')" 
                                                    class="bg-indigo-600 hover:bg-indigo-700 text-white text-xs px-3 py-1 rounded">
                                                ğŸ“‹ ë³µì‚¬
                                            </button>
                                        </div>
                                        <p class="text-xs text-gray-700 leading-relaxed">${img.prompt}</p>
                                    </div>
                                </div>
                            `).join('')}
                            </div>
                            
                            <div class="bg-gradient-to-r from-blue-50 to-purple-50 border-l-4 border-indigo-500 p-6 mb-6 rounded-lg">
                                <p class="text-indigo-900 font-bold mb-2">ğŸ’¡ ì‚¬ìš© ë°©ë²•</p>
                                <ol class="text-sm text-indigo-800 space-y-2">
                                    <li>1ï¸âƒ£ ê° í”„ë¡¬í”„íŠ¸ ì˜†ì˜ "ğŸ“‹ ë³µì‚¬" ë²„íŠ¼ í´ë¦­</li>
                                    <li>2ï¸âƒ£ AI ì´ë¯¸ì§€ ìƒì„± ë„êµ¬(Midjourney, DALL-E, Stable Diffusion ë“±) ì ‘ì†</li>
                                    <li>3ï¸âƒ£ ë³µì‚¬í•œ í”„ë¡¬í”„íŠ¸ ë¶™ì—¬ë„£ê¸° í›„ ìƒì„±</li>
                                    <li>4ï¸âƒ£ ìƒì„±ëœ ì´ë¯¸ì§€ë¥¼ ë¸”ë¡œê·¸ ê¸€ì˜ í•´ë‹¹ ìœ„ì¹˜ì— ì‚½ì…</li>
                                </ol>
                            </div>

                            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                                <p class="text-yellow-800 text-sm">
                                    <strong>âœ¨ ì¶”ì²œ AI ì´ë¯¸ì§€ ìƒì„± ë„êµ¬:</strong><br>
                                    â€¢ Midjourney (ê³ í’ˆì§ˆ, ìœ ë£Œ)<br>
                                    â€¢ DALL-E 3 (ChatGPT Plus)<br>
                                    â€¢ Stable Diffusion (ë¬´ë£Œ)<br>
                                    â€¢ Leonardo.ai (ì¼ë¶€ ë¬´ë£Œ)
                                </p>
                            </div>
                            
                            <div class="flex flex-wrap gap-3">
                                <button onclick="assistant.setState({ currentStep: 'content' })" 
                                        class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                                    â† ê¸€ ë‹¤ì‹œ ë³´ê¸°
                                </button>
                                <button onclick="assistant.reset()" 
                                        class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                                    âœ¨ ìƒˆ ê¸€ ì‘ì„±í•˜ê¸°
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Initialize app
        let assistant;
        window.addEventListener('DOMContentLoaded', () => {
            assistant = new BlogAssistant();
        });
    </script>
</body>
</html>
